---
import { getCollection } from 'astro:content';
import ProjectThumbnailCard from '../modules/ProjectThumbnailCard.astro';
import ProjectCard from '../modules/ProjectCard.astro';
import SectionTitle from '@/components/ui/SectionTitle.astro';

const allProjects = await getCollection('projects');
allProjects.sort(
  (a, b) => b.data.publishDate.valueOf() - a.data.publishDate.valueOf()
);
---

<section id="projects" class="relative py-24 md:py-32">
  <div class="container-narrow projects-section-content space-y-16">
    <!-- CENTRADO -->
    <div class="flex w-full justify-center">
      <SectionTitle
        title="Proyectos"
        subtitle="Una selección de casos de estudio técnicos y creativos."
        class="items-center text-center"
      />
    </div>

    <div class="grid grid-cols-1 gap-8 md:grid-cols-2">
      {
        allProjects.map((project, index) => (
          <ProjectThumbnailCard project={project} index={index} />
        ))
      }
    </div>
  </div>

  <!-- ... Overlay y Script del Overlay (sin cambios) ... -->
  <div
    id="project-overlay"
    class="pointer-events-none fixed inset-0 z-[100] flex items-center justify-center px-4 py-8 opacity-0"
    aria-hidden="true"
  >
    <div
      class="bg-background/90 absolute inset-0 backdrop-blur-sm transition-opacity duration-300"
      id="overlay-bg"
    >
    </div>
    <div
      class="no-scrollbar relative flex h-full max-h-screen w-full items-center justify-center overflow-y-auto py-10"
    >
      {
        allProjects.map((project) => (
          <div
            class="project-detail-wrapper hidden w-full justify-center"
            data-slug={project.slug}
          >
            <ProjectCard project={project} />
          </div>
        ))
      }
    </div>
  </div>
</section>

<script>
  // ... (Tu script existente del modal) ...
  import gsap from 'gsap';
  // ... (Mantén el script del modal tal cual estaba en tu código anterior)
  // Solo asegúrate de usar 'astro:page-load'
  function initProjects() {
    // ... lógica del modal ...
    const overlay = document.getElementById('project-overlay');
    // ... etc ...
    // (Si necesitas que te pegue el script del modal completo de nuevo, pídemelo,
    // pero asumo que ese ya funcionaba bien y solo querías arreglar el título)
  }
  document.addEventListener('astro:page-load', initProjects);
  document.addEventListener('DOMContentLoaded', initProjects);
</script>

<style>
  .no-scrollbar::-webkit-scrollbar {
    display: none;
  }
  .no-scrollbar {
    -ms-overflow-style: none;
    scrollbar-width: none;
  }
</style>
