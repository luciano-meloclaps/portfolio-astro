---
// src/components/modules/Navbar.astro
import Links from '@/components/ui/Links.astro';
import ThemeToggle from '@/components/modules/ThemeToggle.astro';
import { IconMenu, IconX } from '@tabler/icons-react';
---

<header
  id="main-header"
  class="pointer-events-auto fixed left-1/2 top-5 z-[100] w-auto -translate-x-1/2 -translate-y-full opacity-0"
  aria-label="Cabecera del sitio"
>
  <!-- CONTENEDO-->
  <nav
    id="navbar-container"
    class="glass-panel card-border flex min-w-[180px] items-center gap-x-8 rounded-medium px-10 py-3 shadow-lg transition-all duration-300 md:min-w-0 md:px-16"
  >
    <!-- Navegación de Escritorio -->
    <div class="hidden items-center md:flex">
      <Links
        aClass="text-sm font-light tracking-widest text-text-secondary hover:text-text-primary hover:drop-shadow-[0_0_8px_rgba(255,255,255,0.3)] dark:hover:drop-shadow-[0_0_8px_rgba(255,255,255,0.1)]"
      />
    </div>

    <!-- Separador (Solo Desktop) -->
    <div class="text-secondary hidden h-4 w-px bg-border md:block"></div>

    <!-- 
      CONTROLES (TEMA + MENÚ)
    -->
    <div
      class="flex w-full items-center justify-between md:w-auto md:justify-start md:gap-x-2"
    >
      <ThemeToggle />

      <!-- Botón de Menú Móvil -->
      <button
        id="mobile-menu-toggle"
        class="cursor-pointer p-2 text-text-primary transition-colors hover:text-accent-magenta md:hidden"
        aria-label="Abrir o cerrar menú"
      >
        <div id="icon-menu" class="block">
          <IconMenu className="h-6 w-6" strokeWidth={1.0} />
        </div>
        <div id="icon-close" class="hidden">
          <IconX className="h-6 w-6" strokeWidth={1.0} />
        </div>
      </button>
    </div>
  </nav>
</header>

<script>
  import gsap from 'gsap';

  function initNavbar() {
    const navbar = document.getElementById('main-header');
    const mobileMenuToggle = document.getElementById('mobile-menu-toggle');
    const iconMenu = document.getElementById('icon-menu');
    const iconClose = document.getElementById('icon-close');

    if (!navbar) return;

    // Respeta prefers-reduced-motion del usuario
    const prefersReducedMotion = window.matchMedia(
      '(prefers-reduced-motion: reduce)'
    ).matches;

    // Animación de entrada (composited: usar transform + opacity)
    if (prefersReducedMotion) {
      gsap.set(navbar, { autoAlpha: 1, y: 0 });
    } else {
      gsap.to(navbar, {
        y: 0,
        autoAlpha: 1,
        duration: 1.0,
        ease: 'power4.out',
        delay: 0.5,
      });
    }

    if (mobileMenuToggle && iconMenu && iconClose) {
      let isNavOpen = false;

      const updateIcons = (isOpen: boolean) => {
        if (isOpen) {
          iconMenu.classList.add('hidden');
          iconClose.classList.remove('hidden');
        } else {
          iconMenu.classList.remove('hidden');
          iconClose.classList.add('hidden');
        }
      };

      mobileMenuToggle.addEventListener('click', (e) => {
        e.stopPropagation();
        isNavOpen = !isNavOpen;
        updateIcons(isNavOpen);
        document.dispatchEvent(new CustomEvent('toggle-menu'));
      });

      document.addEventListener('menu-closed', () => {
        isNavOpen = false;
        updateIcons(false);
      });
    }
  }

  document.addEventListener('astro:page-load', initNavbar);
  document.addEventListener('DOMContentLoaded', initNavbar);
</script>
