---
// src/components/ui/TechChip.astro
import type { FunctionComponent } from 'react';
import { techColorMap, defaultTechColor } from '@/config/tech-colors';

interface Props {
  Icon: FunctionComponent<any> | null;
  name: string;
  label?: string;
  mode?: 'static' | 'filter';
  class?: string;
  iconClass?: string;
  [key: string]: any;
}

const {
  Icon,
  name,
  label,
  mode = 'static',
  class: className = '',
  iconClass = '',
  ...restProps
} = Astro.props;

const color = techColorMap[name.toLowerCase()] || defaultTechColor;
const displayLabel = label || name;
const Tag = mode === 'filter' ? 'button' : 'div';

// --- CLASES BASE (Estructura) ---
const baseClasses = [
  'relative overflow-hidden inline-flex items-center gap-x-2 rounded-sm border bg-clip-padding px-3 py-1.5 backdrop-blur-xl transition-all duration-300 ease-out',
  className,
];

// --- CLASES MODO FILTRO (Interactivo) ---
const filterClasses = [
  'filter-chip js-filter-chip group select-none cursor-pointer',
  'focus:outline-none focus-visible:ring-2 focus-visible:ring-offset-2',
  'active:scale-95',
];

// --- CLASES MODO ESTÁTICO (Informativo) ---
const staticClasses = ['cursor-default'];

const classes =
  mode === 'filter'
    ? [...baseClasses, ...filterClasses]
    : [...baseClasses, ...staticClasses];
---

<Tag
  class:list={classes}
  style={{ '--chip-color': color } as any}
  {...restProps}
>
  <!-- Capa de Brillo (Pointer Events None para no bloquear click) -->
  <div class="shine-effect pointer-events-none absolute inset-0 z-0"></div>

  <!-- Contenido Principal -->
  <span class="pointer-events-none relative z-10 flex items-center gap-x-2">
    {
      Icon && (
        <Icon class:list={['icon-base h-4 w-4', iconClass]} strokeWidth={1.5} />
      )
    }
    <span class="font-sans text-xs font-light uppercase tracking-wider"
      >{displayLabel}</span
    >
  </span>

  <!-- Indicador de Cierre (Solo Filtros) -->
  {
    mode === 'filter' && (
      <span
        class="remove-x pointer-events-none relative z-10 ml-2 hidden text-xs opacity-70 transition-opacity duration-150 group-hover:opacity-100"
        data-remove-x
      >
        ✕
      </span>
    )
  }
</Tag>

<style>
  /* =========================================
     ESTILOS MODO ESTÁTICO (Cards)
     ========================================= */
  div:not(.filter-chip) {
    color: var(--chip-color);
    border-color: var(--chip-color);
    background-color: color-mix(in srgb, var(--chip-color), transparent 90%);
  }

  /* =========================================
     ESTILOS MODO FILTRO (Botones)
     ========================================= */

  /* 1. Estado INACTIVO (Ghost) */
  .filter-chip[data-filter-active='false'] {
    color: var(--color-text-secondary);
    border-color: rgba(128, 128, 128, 0.2);
    background-color: transparent;
    opacity: 0.8;
  }

  /* Ajuste Light Mode: Mayor contraste */
  :global(html:not(.dark)) .filter-chip[data-filter-active='false'] {
    background-color: rgba(0, 0, 0, 0.04);
    border-color: rgba(0, 0, 0, 0.15);
  }

  /* 2. Estado HOVER (Preview) */
  .filter-chip[data-filter-active='false']:hover {
    color: var(--chip-color);
    border-color: var(--chip-color);
    background-color: color-mix(in srgb, var(--chip-color), transparent 90%);
    opacity: 1;
    transform: translateY(-1px);
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
  }

  /* 3. Estado ACTIVO (Selected) */
  .filter-chip[data-filter-active='true'] {
    color: var(--chip-color);
    border-color: var(--chip-color);
    background-color: color-mix(in srgb, var(--chip-color), transparent 90%);
    opacity: 1;
    box-shadow: 0 0 8px color-mix(in srgb, var(--chip-color), transparent 40%);
  }

  .filter-chip[data-filter-active='true']:hover {
    box-shadow: 0 0 12px color-mix(in srgb, var(--chip-color), transparent 30%);
  }

  .filter-chip[data-filter-active='true'] .remove-x {
    display: inline-block;
  }

  /* =========================================
     ANIMACIÓN SHINY (Universal)
     ========================================= */
  .shine-effect::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 50%;
    height: 100%;
    background: linear-gradient(
      to right,
      transparent,
      rgba(255, 255, 255, 0.4),
      transparent
    );
    transform: skewX(-25deg);
    transition: none;
  }

  .filter-chip:hover .shine-effect::before {
    animation: shine-anim 0.7s ease-in-out;
  }

  @keyframes shine-anim {
    0% {
      left: -100%;
      opacity: 0;
    }
    50% {
      opacity: 1;
    }
    100% {
      left: 200%;
      opacity: 0;
    }
  }
</style>
