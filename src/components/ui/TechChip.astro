---
// src/components/ui/TechChip.astro
import type { FunctionComponent } from 'react';
import { techColorMap, defaultTechColor } from '@/config/tech-colors';

interface Props {
  Icon: FunctionComponent<any> | null;
  name: string;
  label?: string;
  mode?: 'static' | 'filter';
  class?: string;
  iconClass?: string;
  [key: string]: any;
}

const {
  Icon,
  name,
  label,
  mode = 'static',
  class: className = '',
  iconClass = '',
  ...restProps
} = Astro.props;

const color = techColorMap[name.toLowerCase()] || defaultTechColor;
const displayLabel = label || name;

const Tag = mode === 'filter' ? 'button' : 'div';

const baseClasses = [
  'relative overflow-hidden inline-flex items-center gap-x-2 rounded-sm border bg-clip-padding px-3 py-1.5 backdrop-blur-xl transition-all duration-300 ease-out',
  className,
];

const filterClasses = [
  'filter-chip group select-none cursor-pointer',
  'focus:outline-none focus-visible:ring-2 focus-visible:ring-offset-2',
  'active:scale-95',
];

const staticClasses = ['cursor-default'];
const classes =
  mode === 'filter'
    ? [...baseClasses, ...filterClasses]
    : [...baseClasses, ...staticClasses];
---

<Tag
  class:list={classes}
  style={{
    '--chip-color': color,
  } as any}
  {...restProps}
>
  <div class="shine-effect pointer-events-none absolute inset-0 z-0"></div>

  <span class="pointer-events-none relative z-10 flex items-center gap-x-2">
    {
      Icon && (
        <Icon class:list={['icon-base h-4 w-4', iconClass]} strokeWidth={1.0} />
      )
    }
    <span class="font-sans text-xs font-light uppercase tracking-wider"
      >{displayLabel}</span
    >
  </span>

  {
    mode === 'filter' && (
      <span
        class="remove-x pointer-events-none relative z-10 ml-2 hidden text-xs opacity-70 transition-opacity duration-150 group-hover:opacity-100"
        data-remove-x
      >
        ✕
      </span>
    )
  }
</Tag>
<style>
  /* =========================================
     MODO STATIC (Cards)
     ========================================= */
  div:not(.filter-chip) {
    color: var(--chip-color);
    border-color: var(--chip-color);
    background-color: color-mix(in srgb, var(--chip-color), transparent 90%);
  }

  /* =========================================
     MODO FILTER (Botones Interactivos)
     ========================================= */

  /* 1. ESTADO INACTIVO (UNIFORME) */
  .filter-chip[data-filter-active='false'] {
    color: var(--color-text-secondary);

    /* MODO LIGHT: Más cuerpo para que no se pierda */
    background-color: rgba(255, 255, 255, 0);
    border-color: rgba(0, 0, 0, 0.15);
    opacity: 1.2; /* Subimos opacidad para legibilidad */
  }

  /* MODO DARK: Ajuste específico para fondo oscuro */
  :global(.dark) .filter-chip[data-filter-active='false'] {
    background-color: rgba(255, 255, 255, 0.03);
    border-color: rgba(255, 255, 255, 0.15);
    opacity: 0.8;
  }

  /* 2. ESTADO HOVER (PREVIEW) */
  .filter-chip[data-filter-active='false']:hover {
    color: var(--chip-color);
    border-color: var(--chip-color);
    background-color: color-mix(in srgb, var(--chip-color), transparent 90%);
    opacity: 1;
    transform: translateY(-1px);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
  }

  /* 3. ESTADO ACTIVO (SELECTED) */
  .filter-chip[data-filter-active='true'] {
    color: var(--chip-color);
    border-color: var(--chip-color);
    background-color: color-mix(in srgb, var(--chip-color), transparent 90%);
    opacity: 1;
    box-shadow: 0 0 8px color-mix(in srgb, var(--chip-color), transparent 40%);
  }

  .filter-chip[data-filter-active='true']:hover {
    box-shadow: 0 0 12px color-mix(in srgb, var(--chip-color), transparent 30%);
  }

  .filter-chip[data-filter-active='true'] .remove-x {
    display: inline-block;
  }

  /* --- ANIMACIÓN SHINY --- */
  .shine-effect::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 50%;
    height: 100%;
    background: linear-gradient(
      to right,
      transparent,
      rgba(255, 255, 255, 0.4),
      transparent
    );
    transform: skewX(-25deg);
    transition: none;
  }

  .filter-chip:hover .shine-effect::before {
    animation: shine-anim 0.7s ease-in-out;
  }

  @keyframes shine-anim {
    0% {
      left: -100%;
      opacity: 0;
    }
    50% {
      opacity: 1;
    }
    100% {
      left: 200%;
      opacity: 0;
    }
  }
</style>
