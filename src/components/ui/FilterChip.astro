---
import type { FunctionComponent } from 'react';
import { techColorMap, defaultTechColor } from '@/config/tech-colors';

interface Props {
  Icon: FunctionComponent<any> | string;
  name: string;
  label?: string;
  sectionId?: string;
  iconClass?: string;
  class?: string;
}

const {
  Icon,
  name,
  label,
  sectionId = 'projects',
  iconClass = '',
  class: className = '',
} = Astro.props;

const displayLabel = label || name;
---

<!-- 
  FilterChip: Componente de presentación pura (DUMB COMPONENT)
  No tiene lógica de interactividad en su script
  El estado es manejado por FilterBar (parent orchestrator)
  Reutiliza el diseño visual de ChipTech
-->
<button
  class:list={[
    'filter-chip group inline-flex select-none items-center gap-x-2 rounded-md border bg-clip-padding px-3 py-1.5 backdrop-blur-xl',
    className,
  ]}
  data-filter-name={name}
  data-filter-section={sectionId}
  data-filter-active="false"
  aria-pressed="false"
  aria-label={`Filtrar por ${displayLabel}`}
  title={`Clic para filtrar por ${displayLabel}`}
>
  <!-- Icono (heredado de ChipTech) -->
  <Icon class:list={['icon-base h-4 w-4', iconClass]} strokeWidth={1.5} />

  <!-- Texto (heredado de ChipTech) -->
  <span class="font-sans text-xs font-light uppercase tracking-wider">
    {displayLabel}
  </span>

  <!-- Remove indicator: solo en estado activo -->
  <span
    class="remove-x ml-auto text-xs opacity-70 transition-opacity duration-150 group-hover:opacity-100"
    data-remove-x>✕</span
  >
</button>

<style>
  /* 
    Estilos heredados de ChipTech + estados interactivos
    IMPORTANTE: Los estados se aplican vía data-filter-active (manejado por FilterBar)
  */
  .filter-chip {
    cursor: pointer;
    position: relative;
    overflow: hidden;
    transition: all 300ms cubic-bezier(0.33, 0.66, 0.66, 1);
  }

  /* Estado INACTIVO: gris monocromático */
  .filter-chip[data-filter-active='false'] {
    color: #888888;
    border-color: #888888;
    background-color: #8888881a;
    opacity: 0.7;
  }

  .filter-chip[data-filter-active='false']:hover {
    opacity: 0.85;
  }

  /* Estado ACTIVO: color tech específico, shine, glow */
  .filter-chip[data-filter-active='true'] {
    color: var(--chip-color, #61dafb);
    border-color: var(--chip-color, #61dafb);
    background-color: var(--chip-color, #61dafb) 1a;
    opacity: 1;
    /* Blur effect de fondo suave detrás del chip */
    backdrop-filter: blur(2px);
  }

  /* Shine effect (solo activo) */
  .filter-chip[data-filter-active='true']::before {
    content: '';
    position: absolute;
    top: -50%;
    left: -50%;
    width: 200%;
    height: 200%;
    background: linear-gradient(
      45deg,
      transparent 30%,
      rgba(255, 255, 255, 0.2) 50%,
      transparent 70%
    );
    transform: rotate(45deg);
    pointer-events: none;
    opacity: 0;
  }

  .filter-chip[data-filter-active='true']:hover::before {
    animation: shine 0.5s cubic-bezier(0.4, 0, 0.2, 1);
  }

  /* Glow effect (solo activo) */
  .filter-chip[data-filter-active='true']:hover {
    filter: drop-shadow(0 0 0.75rem currentColor / 0.5);
  }

  /* Press feedback visual (INSTANT, sin GSAP) */
  .filter-chip:active {
    transform: scale(0.94);
  }

  /* Shine animation */
  @keyframes shine {
    0% {
      transform: translateX(-100%) translateY(-100%) rotate(45deg);
      opacity: 0;
    }
    50% {
      opacity: 1;
    }
    100% {
      transform: translateX(100%) translateY(100%) rotate(45deg);
      opacity: 0;
    }
  }

  /* Remove indicator - hidden by default, shown when active */
  .remove-x {
    cursor: pointer;
    display: none;
  }

  .filter-chip[data-filter-active='true'] .remove-x {
    display: inline;
  }

  /* Focus visible para accesibilidad */
  :where(.filter-chip):focus-visible {
    outline: 2px solid currentColor;
    outline-offset: 2px;
  }
</style>
