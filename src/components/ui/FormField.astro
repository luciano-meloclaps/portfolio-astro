---
// FormField.astro
// ===============
// Campo de formulario reutilizable con validación y accesibilidad
// - Label flotante accesible
// - Estados visuales coherentes con Hero (variables CSS)
// - Borde fino en error (var(--error)), fondo suave (var(--error-weak))
// - Textarea expandible horizontalmente (resize: horizontal)
// - Aria-invalid y aria-describedby para mensajes de error

interface Props {
  id: string;
  label: string;
  type?: 'text' | 'email';
  as?: 'input' | 'textarea';
  required?: boolean;
}

const {
  id,
  label,
  type = 'text',
  as = 'input',
  required = false,
} = Astro.props;

const errorMessageId = `${id}-error`;
const helperId = `${id}-helper`;
---

<div class="form-field group relative">
  <!-- Label flotante accesible -->
  <label
    for={id}
    class="absolute -top-2 left-4 bg-background px-1 text-xs font-medium uppercase tracking-wide text-text-secondary transition-colors duration-200 group-focus-within:text-text-primary"
  >
    {label}
  </label>

  <!-- Input o Textarea con estados de validación basados en variables CSS -->
  {
    as === 'input' ? (
      <input
        type={type}
        id={id}
        name={id}
        required={required}
        aria-invalid="false"
        aria-describedby={errorMessageId}
        class="field-input w-full rounded-small border border-border bg-transparent px-4 py-3 text-text-primary transition-all duration-200 hover:border-text-primary/50 focus:border-text-primary focus:outline-none focus:ring-1 focus:ring-text-primary/30 disabled:opacity-50 disabled:cursor-not-allowed"
      />
    ) : (
      <textarea
        id={id}
        name={id}
        required={required}
        rows={4}
        aria-invalid="false"
        aria-describedby={errorMessageId}
        class="field-input w-full rounded-small border border-border bg-transparent px-4 py-3 text-text-primary transition-all duration-200 hover:border-text-primary/50 focus:border-text-primary focus:outline-none focus:ring-1 focus:ring-text-primary/30 disabled:opacity-50 disabled:cursor-not-allowed"
      />
    )
  }

  <!-- Mensaje de error (hidden por defecto) -->
  <p
    id={errorMessageId}
    class="error-message mt-2 hidden text-left text-xs font-medium"
    role="alert"
    aria-live="polite"
  >
  </p>

  <!-- Mensaje de éxito/validación (hidden por defecto) -->
  <p
    id={helperId}
    class="helper-message mt-2 hidden text-left text-xs font-medium"
    aria-live="polite"
  >
  </p>
</div>

<style>
  /**
   * Estados visuales del campo basados en aria-invalid
   * Usa variables CSS del proyecto para coherencia homogénea con Hero
   */

  /* Estado de error: aria-invalid="true" */
  :global(.field-input[aria-invalid="true"]) {
    /* Colores de error del sistema */
    border-color: var(--error, #ef4444);
    background-color: var(--error-weak, rgba(239, 68, 68, 0.08));
    color: var(--error-text, #dc2626);
  }

  :global(.field-input[aria-invalid="true"]:focus) {
    border-color: var(--error, #ef4444);
    box-shadow: 0 0 0 1px rgba(239, 68, 68, 0.3);
  }

  :global(.field-input[aria-invalid="true"]::placeholder) {
    color: var(--error-text, #dc2626);
    opacity: 0.6;
  }

  /* Estado disabled */
  :global(.field-input:disabled) {
    opacity: 0.5;
    cursor: not-allowed;
  }

  /* Textarea: scroll vertical, no resize para mantener armonía del grid */
  :global(textarea.field-input) {
    min-height: 120px;
    max-height: 240px;
    max-width: 100%;
    resize: none;
    overflow-y: auto;
  }

  /* Error message: rojo suave, visible en ambos temas */
  :global(.error-message) {
    color: var(--error-text, #dc2626);
  }

  /* Helper/success message: verde suave, visible en ambos temas */
  :global(.helper-message) {
    color: var(--success, #10b981);
  }
</style>
