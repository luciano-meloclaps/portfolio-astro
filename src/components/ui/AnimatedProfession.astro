---
// src/components/ui/AnimatedProfession.astro
interface Props {
  class?: string;
}

const { class: className } = Astro.props;

// Frases del Hero
const phrases = [
  { stroke: 'FULL-STACK', fill: 'DEVELOPER' },
  { stroke: 'UX/UI', fill: 'DESIGNER' },
];
---

<!-- 
  CAMBIOS RESPONSIVE APLICADOS:
  1. 'flex-col': Por defecto (Móvil) es columna.
  2. 'lg:flex-row': AHORA SOLO se pone horizontal en pantallas Grandes (Laptop/Desktop), saltándose la Tablet.
  3. 'items-center': Centrado horizontalmente cuando está en columna (Móvil/Tablet).
  4. 'lg:items-baseline': Alineado a la base del texto cuando está en fila (Desktop).
  5. 'gap-2 lg:gap-4': Ajuste de espaciado.
-->
<div
  class:list={[
    'hero-profession relative inline-flex flex-col items-center gap-2 text-4xl font-bold uppercase tracking-tighter md:text-6xl lg:flex-row lg:items-baseline lg:gap-4 lg:text-7xl',
    className,
  ]}
>
  <!-- SEO -->
  <h1 class="sr-only">
    {phrases.map((p) => `${p.stroke} ${p.fill}`).join(', ')}
  </h1>

  <!-- Visual -->
  <div
    class="flex flex-col items-center gap-2 lg:flex-row lg:items-baseline lg:gap-4"
    aria-hidden="true"
  >
    <!-- Stroke -->
    <span
      class="text-stroke-thin text-center opacity-80 lg:text-left"
      data-role="stroke"></span>

    <!-- Fill -->
    <span
      class="relative text-center text-text-primary lg:text-left"
      data-role="fill"
    >
      <!-- Cursor -->
      <span
        class="cursor-blink absolute -right-3 bottom-1 top-1 w-[2px] bg-accent-magenta opacity-0 shadow-[0_0_10px_var(--color-accent-magenta)] lg:-right-4 lg:w-[3px]"
      ></span>
    </span>
  </div>
</div>

<style>
  .text-stroke-thin {
    -webkit-text-stroke: 0.5px var(--color-text-primary);
    color: transparent;
  }
  :global(.dark) .text-stroke-thin {
    -webkit-text-stroke: 0.5px rgba(255, 255, 255, 0.6);
  }
</style>

<script>
  import gsap from 'gsap';
  import { scrambleText } from '@/lib/animation.ts';

  function initHeroAnimation() {
    const wrappers = document.querySelectorAll('.hero-profession');

    wrappers.forEach((wrapper) => {
      if (wrapper.hasAttribute('data-init')) return;
      wrapper.setAttribute('data-init', 'true');

      const strokeEl = wrapper.querySelector(
        '[data-role="stroke"]'
      ) as HTMLElement;
      const fillEl = wrapper.querySelector('[data-role="fill"]') as HTMLElement;
      const cursorEl = wrapper.querySelector('.cursor-blink');

      const phrases = [
        { stroke: 'FULL-STACK', fill: 'DEVELOPER' },
        { stroke: 'UX/UI', fill: 'DESIGNER' },
      ];

      const masterTl = gsap.timeline({ repeat: -1 });

      phrases.forEach((phrase) => {
        const stepTl = gsap.timeline({
          repeat: 1,
          yoyo: true,
          repeatDelay: 2.5,
        });

        stepTl.set(cursorEl, { opacity: 1 });

        stepTl.add(scrambleText(strokeEl, phrase.stroke, 1.0));
        stepTl.add(scrambleText(fillEl, phrase.fill, 1.0), '-=0.8');

        stepTl.set(cursorEl, { opacity: 0 }, '+=0.1');

        masterTl.add(stepTl);
      });

      gsap.to(cursorEl, {
        opacity: 0,
        duration: 0.5,
        repeat: -1,
        yoyo: true,
        ease: 'steps(1)',
      });
    });
  }

  document.addEventListener('astro:page-load', initHeroAnimation);
  document.addEventListener('DOMContentLoaded', initHeroAnimation);
</script>
