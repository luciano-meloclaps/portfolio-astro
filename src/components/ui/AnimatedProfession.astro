---
// src/components/ui/AnimatedProfession.astro
interface Props {
  class?: string;
}

const { class: className } = Astro.props;

const phrases = [
  { stroke: 'FULL-STACK', fill: 'DEVELOPER' },
  { stroke: 'UX/UI', fill: 'DESIGNER' },
];
---

<div
  class:list={[
    'hero-profession relative inline-flex flex-col items-center gap-2 text-4xl font-bold uppercase tracking-tighter md:text-6xl lg:flex-row lg:items-baseline lg:gap-4 lg:text-7xl',
    className,
  ]}
>
  <h1 class="sr-only">
    {phrases.map((p) => `${p.stroke} ${p.fill}`).join(', ')}
  </h1>

  <div
    class="flex flex-col items-center gap-2 lg:flex-row lg:items-baseline lg:gap-4"
    aria-hidden="true"
  >
    <!-- Stroke -->
    <span
      class="text-stroke-thin text-center opacity-80 lg:text-left"
      data-role="stroke"></span>

    <!-- Fill -->
    <span
      class="relative text-center text-text-primary lg:text-left"
      data-role="fill"
    >
      <span
        class="cursor-blink absolute -right-3 bottom-1 top-1 w-[2px] bg-accent-magenta opacity-0 shadow-[0_0_10px_var(--color-accent-magenta)] lg:-right-4 lg:w-[3px]"
      ></span>
    </span>
  </div>
</div>

<style>
  .text-stroke-thin {
    -webkit-text-stroke: 0.5px var(--color-text-primary);
    color: transparent;
  }
  :global(.dark) .text-stroke-thin {
    -webkit-text-stroke: 0.5px rgba(255, 255, 255, 0.6);
  }
</style>

<script>
  import gsap from 'gsap';
  import { scrambleText } from '@/lib/animations';

  function initHeroAnimation() {
    const wrappers = document.querySelectorAll('.hero-profession');

    wrappers.forEach((wrapper) => {
      if (wrapper.hasAttribute('data-init')) return;
      wrapper.setAttribute('data-init', 'true');

      const strokeEl = wrapper.querySelector(
        '[data-role="stroke"]'
      ) as HTMLElement;
      const fillEl = wrapper.querySelector('[data-role="fill"]') as HTMLElement;
      const cursorEl = wrapper.querySelector('.cursor-blink');

      // Define las frases a animar (Opción 2: Solo 2 frases, más cinematográfico)
      const phrases = [
        { stroke: 'FULL-STACK', fill: 'DEVELOPER' },
        { stroke: 'UX/UI', fill: 'DESIGNER' },
      ];

      const masterTl = gsap.timeline({ repeat: -1 });

      // Cursor parpadeante independiente - timing estándar terminal
      gsap.to(cursorEl, {
        opacity: 0,
        duration: 0.5, // Opción 2: Estándar terminal (más elegante)
        repeat: -1,
        yoyo: true,
        ease: 'steps(1)',
      });

      phrases.forEach((phrase: { stroke: string; fill: string }) => {
        const stepTl = gsap.timeline({
          repeat: 1,
          yoyo: true,
          repeatDelay: 1.8, // Opción 2: Pausa noble pero no excesiva
        });

        // Limpiar estado anterior
        stepTl.call(() => {
          strokeEl.innerText = '';
          fillEl.innerText = '';
          Object.keys(strokeEl.dataset).forEach((key) => {
            if (key.startsWith('char')) delete strokeEl.dataset[key];
          });
          Object.keys(fillEl.dataset).forEach((key) => {
            if (key.startsWith('char')) delete fillEl.dataset[key];
          });
        });

        stepTl.set(cursorEl, { opacity: 1 });
        stepTl.add(scrambleText(strokeEl, phrase.stroke, 1.2), 0); // Opción 2: 1.2s (más cinematográfico)
        stepTl.add(scrambleText(fillEl, phrase.fill, 1.2), 0.25); // Offset aumentado a 0.25s
        stepTl.set(cursorEl, { opacity: 0 }, '+=0.1');

        masterTl.add(stepTl);
      });
    });
  }

  document.addEventListener('astro:page-load', initHeroAnimation);
  document.addEventListener('DOMContentLoaded', initHeroAnimation);
</script>
